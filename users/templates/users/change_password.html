{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Сброс пароля</title>
  <link rel="stylesheet" href="{% static 'users/css/registration.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.3/font/bootstrap-icons.min.css">
</head>
<body>
  <div class="registration-wrapper">
    <div class="registration-container">
      <div class="avatar-top">
        <img src="{% static 'users/img/bulldog.png' %}" alt="Аватар">
      </div>

      <!-- Прогресс-бар -->
      <div class="progress-line">
        <div class="circle active">1</div>
        <div class="line"></div>
        <div class="circle">2</div>
      </div>

      <!-- Форма -->
      <form class="registration-form" id="mainForm">
        <!-- Шаг 1 -->
        <div class="step active" id="form-step-1">
          <h2>Шаг 1: Подтверждение</h2>
          <input type="text" placeholder="Код из SMS" required>

          <div id="timer-container">
            <i class="bi bi-hourglass-split" id="hourglass"></i>
            <p>Повторная отправка через <span id="timer">10</span> сек</p>
          </div>

          <div class="step-buttons-container">
            <button type="button" class="back-btn" onclick="window.location.href='{% url 'login' %}'">Назад</button>
            <button type="button" class="next-btn" onclick="nextStep()">Далее</button>
          </div>
        </div>

        <!-- Шаг 2 -->
        <div class="step hidden" id="form-step-2">
          <h2>Шаг 2: Новый пароль</h2>
          <input type="password" placeholder="Новый пароль" required>
          <input type="password" placeholder="Повторите пароль" required>

          <div class="step-buttons-container">
            <button type="button" class="back-btn" onclick="prevStep()">Назад</button>
            <button type="button" class="next-btn" onclick="showSuccess()">Готово</button>
          </div>
        </div>

        <!-- Сообщение об успехе -->
        <div id="success-message" class="hidden">
          <h2>✅ Пароль успешно изменен!</h2>
          <p>Через 5 секунд вы будете перенаправлены на страницу входа...</p>
        </div>
      </form>
    </div>
  </div>

  <script>
    let currentStep = 1;
    let timeRemaining = 10;
    let timerInterval;

    function updateProgress() {
      // Скрываем все шаги
      document.querySelectorAll('.step').forEach(step => {
        step.classList.remove('active');
        step.classList.add('hidden');
      });

      // Показываем текущий шаг
      const currentStepElement = document.querySelector(`#form-step-${currentStep}`);
      currentStepElement.classList.remove('hidden');
      currentStepElement.classList.add('active');

      // Обновляем прогресс-бар
      document.querySelectorAll('.circle').forEach((circle, index) => {
        circle.classList.toggle('active', index < currentStep);
      });
    }

    function nextStep() {
      if (currentStep < 2) {
        currentStep++;
        updateProgress();
      }
    }

    function prevStep() {
      if (currentStep > 1) {
        currentStep--;
        updateProgress();
      }
    }

    function showSuccess() {
      const pwd1 = document.querySelectorAll('input[type="password"]')[0].value;
      const pwd2 = document.querySelectorAll('input[type="password"]')[1].value;

      if (pwd1 !== pwd2) {
        alert('Пароли не совпадают!');
        return;
      }

      // Скрываем все шаги
      document.querySelectorAll('.step').forEach(step => {
        step.classList.add('hidden');
        step.classList.remove('active');
      });

      // Показываем сообщение об успехе
      const successMessage = document.getElementById('success-message');
      successMessage.classList.remove('hidden');
      successMessage.classList.add('active');

      // Перенаправление через 5 секунд
      setTimeout(() => {
        window.location.href = "{% url 'login' %}";
      }, 5000);
    }

    // Инициализация при загрузке страницы
    document.addEventListener('DOMContentLoaded', function() {
      updateProgress();
      startTimer();
    });

    function startTimer() {
      document.getElementById('timer').textContent = timeRemaining;
      timerInterval = setInterval(function() {
        timeRemaining--;
        if (timeRemaining <= 0) {
          clearInterval(timerInterval);
          timeRemaining = 0;
          document.getElementById('timer-container').style.display = 'none';
          document.getElementById('resend-btn').style.display = 'block';
        }
        document.getElementById('timer').textContent = timeRemaining;
      }, 1000);
    }
  </script>
</body>
</html>