{% extends 'base_no_sidebar.html' %}
{% load static %}

{% block title %}–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/registration.css' %}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@18.1.1/build/css/intlTelInput.min.css">
<style>
    .completion-wrapper {
        max-width: 600px;
        margin: 50px auto;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(124, 77, 255, 0.15);
        padding: 40px;
    }
    
    .completion-header {
        text-align: center;
        margin-bottom: 30px;
    }
    
    .completion-title {
        font-size: 2rem;
        font-weight: 700;
        background: linear-gradient(135deg, #7c4dff, #9c27b0);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 10px;
    }
    
    .completion-subtitle {
        color: #666;
        font-size: 1.1rem;
        margin-bottom: 20px;
    }
    
    .welcome-message {
        background: linear-gradient(135deg, #e8f5e8, #f0f8ff);
        border-left: 4px solid #7c4dff;
        padding: 15px 20px;
        border-radius: 8px;
        margin-bottom: 30px;
    }
    
    .welcome-message .provider {
        color: #7c4dff;
        font-weight: 600;
    }
    
    .field-group {
        margin-bottom: 20px;
    }
    
    .field-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #333;
        font-size: 0.95rem;
    }
    
    .required {
        color: #e74c3c;
    }
    
    .form-control {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 1rem;
        transition: border-color 0.3s ease;
    }
    
    .form-control:focus {
        border-color: #7c4dff;
        outline: none;
        box-shadow: 0 0 0 3px rgba(124, 77, 255, 0.1);
    }
    
    .submit-btn {
        width: 100%;
        background: linear-gradient(135deg, #7c4dff, #9c27b0);
        color: white;
        padding: 15px;
        border: none;
        border-radius: 12px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 20px;
        box-shadow: 0 4px 20px rgba(124, 77, 255, 0.3);
    }
    
    .submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 30px rgba(124, 77, 255, 0.4);
    }
    
    .error-message {
        color: #e74c3c;
        font-size: 0.9rem;
        margin-top: 5px;
    }
    
    .skip-link {
        text-align: center;
        margin-top: 20px;
    }
    
    .skip-link a {
        color: #888;
        text-decoration: none;
        font-size: 0.9rem;
    }
    
    .skip-link a:hover {
        color: #7c4dff;
        text-decoration: underline;
    }
    
    @media (max-width: 768px) {
        .completion-wrapper {
            margin: 20px;
            padding: 30px 20px;
        }
        
        .completion-title {
            font-size: 1.5rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="completion-wrapper">
    <div class="completion-header">
        <h1 class="completion-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ EngAI!</h1>
        <p class="completion-subtitle">–ó–∞–≤–µ—Ä—à–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É –≤–∞—à–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è</p>
    </div>
    
    <div class="welcome-message">
        <p>üéâ –û—Ç–ª–∏—á–Ω–æ! –í—ã —É—Å–ø–µ—à–Ω–æ –≤–æ—à–ª–∏ —á–µ—Ä–µ–∑ <span class="provider">{{ provider_name }}</span>.</p>
        <p>–ß—Ç–æ–±—ã –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–∞—à–µ –æ–±—É—á–µ–Ω–∏–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π.</p>
    </div>
    
    {% if messages %}
        <div class="messages">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}
    
    <form method="POST" class="completion-form">
        {% csrf_token %}
        
        <div class="field-group">
            <label for="{{ form.first_name.id_for_label }}" class="field-label">
                {{ form.first_name.label }} <span class="required">*</span>
            </label>
            {{ form.first_name }}
            {% if form.first_name.errors %}
                <div class="error-message">{{ form.first_name.errors }}</div>
            {% endif %}
        </div>
        
        <div class="field-group">
            <label for="{{ form.last_name.id_for_label }}" class="field-label">
                {{ form.last_name.label }} <span class="required">*</span>
            </label>
            {{ form.last_name }}
            {% if form.last_name.errors %}
                <div class="error-message">{{ form.last_name.errors }}</div>
            {% endif %}
        </div>
        
        <div class="field-group">
            <label for="{{ form.city.id_for_label }}" class="field-label">
                {{ form.city.label }} <span class="required">*</span>
            </label>
            {{ form.city }}
            {% if form.city.errors %}
                <div class="error-message">{{ form.city.errors }}</div>
            {% endif %}
        </div>
        
        <div class="field-group">
            <label for="{{ form.current_language_level.id_for_label }}" class="field-label">
                {{ form.current_language_level.label }} <span class="required">*</span>
            </label>
            {{ form.current_language_level }}
            {% if form.current_language_level.errors %}
                <div class="error-message">{{ form.current_language_level.errors }}</div>
            {% endif %}
        </div>
        
        <div class="field-group">
            <label for="{{ form.desired_language_level.id_for_label }}" class="field-label">
                {{ form.desired_language_level.label }} <span class="required">*</span>
            </label>
            {{ form.desired_language_level }}
            {% if form.desired_language_level.errors %}
                <div class="error-message">{{ form.desired_language_level.errors }}</div>
            {% endif %}
        </div>
        
        <div class="field-group">
            <label for="{{ form.phone_number.id_for_label }}" class="field-label">
                {{ form.phone_number.label }}
            </label>
            {{ form.phone_number }}
            {% if form.phone_number.errors %}
                <div class="error-message">{{ form.phone_number.errors }}</div>
            {% endif %}
        </div>
        
        <button type="submit" class="submit-btn">
            üöÄ –ó–∞–≤–µ—Ä—à–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É –ø—Ä–æ—Ñ–∏–ª—è
        </button>
    </form>
    
    <div class="skip-link">
        <a href="{% url 'home' %}">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø–æ–∫–∞ (–º–æ–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ–∑–∂–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö)</a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/intl-tel-input@18.1.1/build/js/intlTelInput.min.js"></script>
<script>
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–Ω–æ–≥–æ –ø–æ–ª—è
document.addEventListener('DOMContentLoaded', function() {
    const phoneInput = document.querySelector("#id_phone_number");
    if (phoneInput) {
        window.intlTelInput(phoneInput, {
            initialCountry: "ru",
            utilsScript: "https://cdn.jsdelivr.net/npm/intl-tel-input@18.1.1/build/js/utils.js",
            separateDialCode: true,
            preferredCountries: ["ru", "kz", "by", "ua"],
            formatOnDisplay: true
        });
    }
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∂–µ–ª–∞–µ–º—ã—Ö —É—Ä–æ–≤–Ω–µ–π
function updateDesiredLevels(currentLevel) {
    const desiredSelect = document.getElementById('id_desired_language_level');
    const levels = ['A1', 'A2', 'B1', 'B2', 'C1', 'C2'];
    const levelNames = {
        'A1': '–ê1 ‚Äî –ù–∞—á–∞–ª—å–Ω—ã–π',
        'A2': '–ê2 ‚Äî –≠–ª–µ–º–µ–Ω—Ç–∞—Ä–Ω—ã–π',
        'B1': 'B1 ‚Äî –°—Ä–µ–¥–Ω–∏–π',
        'B2': 'B2 ‚Äî –í—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ',
        'C1': 'C1 ‚Äî –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π',
        'C2': 'C2 ‚Äî –°–≤–æ–±–æ–¥–Ω—ã–π'
    };
    
    // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–∏–µ –æ–ø—Ü–∏–∏
    desiredSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å</option>';
    
    if (currentLevel) {
        const currentIndex = levels.indexOf(currentLevel);
        // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–∏ –≤—ã—à–µ —Ç–µ–∫—É—â–µ–≥–æ
        for (let i = currentIndex + 1; i < levels.length; i++) {
            const level = levels[i];
            const option = document.createElement('option');
            option.value = level;
            option.textContent = levelNames[level];
            desiredSelect.appendChild(option);
        }
    }
}

// –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–≤–Ω—è
document.getElementById('id_current_language_level').addEventListener('change', function() {
    updateDesiredLevels(this.value);
});
</script>
{% endblock %}